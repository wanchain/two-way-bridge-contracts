import {Cell} from "@ton/core";
import {codeTable} from "./encode-decode";
import {OP_INTERNAL_TRANSFER, OP_TOKENPAIR_Upsert} from "../opcodes"
import {BIP44_CHAINID, TON_COIN_ACCOUT} from "../const/const-value";
import {getQueryID} from "../utils/utils";
import {TON_FEE} from "../fee/fee";

let rawCellStr = "b5ee9c7201010101005000009c50000003000000000000000100000003000012340000456714833589fcd6edb6e08f4c7c32d4f71b54bda02913200000000000000000000000000000000000000000000000000000000000000000"
let rawCellStr1 = 'b5ee9c7241010301006c0002345000000300000000000000010000000300001234000045672a200102005430783833333538396663643665646236653038663463376333326434663731623534626461303239313300400000000000000000000000000000000000000000000000000000000000000000e249552b'

let tokenInfo = {
    tokenOrg: {
        tokenPairId: 0x01,
        srcChainId: 0x1234,
        dstChainId: BIP44_CHAINID,
        srcTokenAcc: "0x833589fcd6edb6e08f4c7c32d4f71b54bda02913",
        dstTokenAcc: '',
    },
    tokenWrapped: {
        tokenPairId: 0x02,
        srcChainId: 0x1234,
        dstChainId: BIP44_CHAINID,
        srcTokenAcc: "0x833589fcd6edb6e08f4c7c32d4f71b54bda02913",
        dstTokenAcc: '',
    },
    coin: {
        tokenPairId: 0x03,
        srcChainId: 0x1234,
        dstChainId: BIP44_CHAINID,
        srcTokenAcc: "0x833589fcd6edb6e08f4c7c32d4f71b54bda02913",
        dstTokenAcc: ''
    },
}
let queryID;
let tokenPairId3 = tokenInfo.coin.tokenPairId;
let srcChainId3 = tokenInfo.coin.srcChainId;
let dstChainId3 = tokenInfo.coin.dstChainId;
let srcTokenAcc3 = tokenInfo.coin.srcTokenAcc;
let dstTokenAcc3 = tokenInfo.coin.dstTokenAcc;
tokenInfo.coin.dstTokenAcc = TON_COIN_ACCOUT;

describe('decode', () => {

    beforeAll(async () => {
        queryID = await getQueryID();
    });

    it('decode AddTokenPair', async () => {
        let rawCellStr1 = "b5ee9c7201021301000468000375500000030000000015c09cc9000004078057414e8000025f14200000000000000000000000000000000000000000000000000000000000000000c00102030028000000000000000000000000000000000000000000403f2fcf95dbd1934307e2f4baee1ae41ff49c2a2e0801201dc1c830bc28b45e2b0114ff00f4a413f4bcf2c80b0402016205060202ce0708001ba0f605da89a1f401f481f481a86104b3420c700925f04e001d0d3030171b08e85135f03db3ce0fa40fa4031fa003171d721fa0031fa003073a9b40002d31f012082100f8a7ea5ba8e85303459db3ce0208210178d4519ba8e8630444403db3ce035248210595f07bcba8090a0b0c00114fa4430c000f2e14d8008a8020d721ed44d0fa00fa40fa40d43004d31f018200fff0218210178d4519ba0282107bdd97deba12b1f2f4d33f0130fa003013a05023c85004fa0258cf1601cf16ccc9ed5401f603d33f0101fa00fa4021f002ed44d0fa00fa40fa40d4305136a1522ac705f2e2c128c2fff2e2c254344270542013541403c85004fa0258cf1601cf16ccc922c8cb0112f400f400cb00c920f9007074c8cb02ca07cbffc9d004fa40f40431fa0020d749c200f2e2c4c88210178d451901cb1f500a01cb3f5008fa020d03f0ed44d0fa00fa40fa40d43008d33f0101fa005151a005fa40fa40535bc70554736d70542013541403c85004fa0258cf1601cf16ccc922c8cb0112f400f400cb00c9f9007074c8cb02ca07cbffc9d0500dc7051cb1f2e2c30afa0051a8a18be726563656976655f746f6b656e738fe143021fe203021e30f050e0f1002d48e843459db3ce06c22ed44d0fa00fa40fa40d43010235f032382106d8e5e3cba8e37335222c705f2e2c1820898968070fb02c8801001cb0558cf1670fa027001cb6a8210d53276db01cb1f01d33f013101cb3fc9810082fb00e0038210768a50b2bae3025f03840ff2f0111200a223cf1601cf1626fa025007cf16c9c8801801cb055004cf1670fa024063775003cb6bcccc2391729171e25008a813a0820a43d580a014bcf2e2c504c98040fb004013c85004fa0258cf1601cf16ccc9ed540070521aa018a1c882107362d09c01cb1f2401cb3f23fa0258cf165009cf16c9c8801001cb0525cf165007fa0250067158cb6accc971fb001046000a103a395f0300ac8208989680b60972fb0226d70b01c30004c20014b08e2ac8801001cb055006cf1670fa027001cb6a8210d53276db01cb1f500301cb3f5003fa02c9810082fb0058926c33e24003c85004fa0258cf1601cf16ccc9ed5400e6ed44d0fa00fa40fa40d43007d33f0101fa00fa40305151a15249c705f2e2c127c2fff2e2c2058209ab3f00a016bcf2e2c3c882107bdd97de01cb1f500501cb3f5003fa0222cf1601cf16c9c8801801cb0523cf1670fa02017158cb6accc98040fb004013c85004fa0258cf1601cf16ccc9ed5400965222c705f2e2c1d33f0101fa40fa00f40430c8801801cb055003cf1670fa0270c882100f8a7ea501cb1f500501cb3f58fa0224cf165004cf16f40070fa02ca00c97158cb6accc98040fb00"
        let cell = Cell.fromBoc(Buffer.from(rawCellStr1, 'hex'))[0];
        let opCode = 0x50000003;
        let decode = codeTable[opCode]["deCode"](cell);
        console.log(decode);
    });

    it('decode should be equal code', async () => {
        let opt = {
            value: TON_FEE.TRANS_FEE_NORMAL,
            queryID,
            tokenPairId: tokenPairId3,
            fromChainID: srcChainId3,
            fromAccount: srcTokenAcc3,
            toChainID: dstChainId3,
            toAccount: dstTokenAcc3,
        }

        let encodedCell = codeTable[OP_TOKENPAIR_Upsert].enCode(opt);
        let bodyCellHex = encodedCell.toBoc().toString('hex');
        console.log(bodyCellHex);
        let decoded = codeTable[OP_TOKENPAIR_Upsert].deCode(encodedCell);
        console.log(decoded);
        let event = codeTable[OP_TOKENPAIR_Upsert].emitEvent(decoded);
        console.log(event);
    });

    it('cell under flow (tonview)', async () => {
        let bodyCelStr = "b5ee9c72010103010056000234500000030000000000000001000000030000123400004567142001020028833589fcd6edb6e08f4c7c32d4f71b54bda0291300400000000000000000000000000000000000000000000000000000000000000000";
        let bodyCell = Cell.fromBoc(Buffer.from(bodyCelStr, 'hex'))[0];
        let opCode = 0x50000003;
        let decode = codeTable[opCode]["deCode"](bodyCell);
        console.log(decode);
    })

    it('cell under flow (sdk)', async () => {
        let bodyCelStr = "b5ee9c72410103010056000234500000030000000000000001000000030000123400004567142001020028833589fcd6edb6e08f4c7c32d4f71b54bda02913004000000000000000000000000000000000000000000000000000000000000000008b8d7029";
        let bodyCell = Cell.fromBoc(Buffer.from(bodyCelStr, 'hex'))[0];
        let opCode = 0x50000003;
        let decode = codeTable[opCode]["deCode"](bodyCell);
        console.log(decode);
    })


    it('decode userlock  token with partner', async () => {
        //let bodyCelStr = "+Wo45iNnMlsp+QECAMmAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQACTgAF5+yHLeYCJ3R2+5hwFhNCPvXwbnqdWSxwPNO8UU+akwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAH0u7C3MbQwtLdCeu6OC";
        let bodyCelStr = "b5ee9c720102030100011c0002ca40000001000000006fc225ad000000000000000000000000000000000000000000746573746e65745f303638000004060000000000000000000000000000000000000000000000000000000005f5e10014f6eb3cb4b187d3201afbf96a38e62367325b29f9010200c98019e2d1908a3b757dc1eb9a4e6cfe5632fa789bcea365ee7ed452693d108b3f97f000a21b8da3f35c1ac4d8745f5d43077e25b2b482a5dbba52b532dd52cad9dda5f600070829dbe0c1c08edaf5f5ba2689cb0a722561e17864183ddc4f8087692ee517c00093800179fb21cb798089dd1dbee61c0584d08fbd7c1b9ea7564b1c0f34ef1453e6a4c0000000000000000000000000000000000000000000000000000000002625a00eec2dcc6d0c2d2dd0";
        let bodyCell = Cell.fromBoc(Buffer.from(bodyCelStr, 'hex'))[0];
        let opCode = 0x40000001;
        let decode = codeTable[opCode]["deCode"](bodyCell);
        console.log(decode);
    })

    it('decode internalTransfer', async () => {
        let bodyCelStr = "b5ee9c720101020100590001a7178d451900000000685a63a1405f5e100801cac063e87cc927b512609cb72e4ed32819818599f9ae2eb00d9edc29d0fb5a270024fbacc73beca70f7223a5c55f9d7e16162bb462b01ee5100746cded9fd3ebd403010000";
        let bodyCell = Cell.fromBoc(Buffer.from(bodyCelStr, 'hex'))[0];
        console.log("bodyCell", bodyCell);
        let opCode = OP_INTERNAL_TRANSFER;
        let decode = codeTable[opCode]["deCode"](bodyCell);
        console.log(decode);
    })

    it('decode smgRelease', async () => {
        let bodyCelStr = "b5ee9c720102040100017f0003e040000005000000003fa11a9d0000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000746573746e65745f30363800000408000000000000000000000000000000000000000000000000000000174876e800010203008300000000000000000000000000000000000000000000000000000000001e84808017806a2c8505125370a864c3e6e634da3737e889731ee4f97699dd03553fc4165000c090f68c3b957845be95900aeb0dc314b566e84dc793806fde691d54887f92779f000000000000000000000000000000000000000000000000000000000000001bff76331f296e7abd2145b326ae2dbcf7f9d8dbc8b2c7190647131438702068c600c3800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000017d784010";
        let bodyCell = Cell.fromBoc(Buffer.from(bodyCelStr, 'hex'))[0];
        console.log("bodyCell", bodyCell);
        let opCode = 0x40000005;
        let decode = codeTable[opCode]["deCode"](bodyCell);
        console.log(decode);
    })
});